---
title: "The MRT dataset: A Case in Exploratory Data Analysis"
author: 'Jose Francisco Endrinal'
output: github_document
---

The Metro Rail Transit (MRT) is a light rail transit system in Metro Manila, Philippines that runs along Epifanio delos Santos Avenue (EDSA) from Taft Avenue Station in Manila, to North Avenue Station in Quezon City. This dataset is the hourly traffic of passengers going in and out of turnstiles at the different train stations covering the years 2012 to 2014.  

I cleaned up this dataset before I put it here so that we can do exploratory data analysis (EDA) straightaway. For the source code on how this was cleaned up, you can check out the link [here]().  

Let's get started!  

## Setup

```{r message=FALSE, warning=FALSE}
# Load packages
suppressPackageStartupMessages({
  library(tidyverse)
  library(lubridate)})
# Load dataset
read_csv("data/clean/mrttraff.csv") %>% 
  mutate(
    station = parse_factor(station, 
               c("taft", 
                 "magallanes", 
                 "ayala", 
                 "buendia", 
                 "guadalupe", 
                 "boni", 
                 "shaw", 
                 "ortigas", 
                 "santolan", 
                 "cubao", 
                 "gma", 
                 "quezon", 
                 "north"), 
               ordered = TRUE)) -> mrt.dt
```

## First look at the dataset

```{r}
# View dataset
mrt.dt
```

This dataset shows the `year`, `month`, `day`, `station`, `hour`, as well as the number of people who have entered the station (`enter`) and who have exited (`exit`) as well the `net` entry/exit (+/-).  

This dataset features all the stations of the MRT covering 24 hours.  

```{r}
unique(mrt.dt$station)
```

```{r}
unique(mrt.dt$hour)
```

Looking at the averages for traffic `entry`, `exit`, and `net` overall, we have the following:

```{r}
summary(select(mrt.dt, entry, exit, net))
```

Our five number summaries give us the above.  

## Exploratory Data Analysis

```{r}
# Distribution of the class/target over the variable
select(mrt.dt, month, hour, station, entry, exit) %>% 
  gather(key = "mode", value = "traff", entry, exit) %>% 
  group_by(station, month, hour, mode) %>% 
  summarise(traff = mean(traff)) %>% 
  ungroup() %>% 
  ggplot(aes(x = hour, y = traff)) + 
    geom_bar(aes(fill = mode), 
             stat = "identity", 
             position = "stack") + 
    facet_wrap(~ station)
```

```{r}
select(mrt.dt, month, hour, station, net) %>% 
  group_by(station, month, hour) %>% 
  summarise(net = mean(net)) %>% 
  ungroup() %>% 
  ggplot(aes(x = hour, y = net)) + 
  geom_bar(stat = "identity", 
           fill = "skyblue") + 
  ylim(-75000, 75000) + 
  facet_wrap(~ station)
```

```{r}
select(mrt.dt, month, hour, station, entry, exit) %>% 
  mutate(avg = (entry + exit)/2) %>% 
  select (-entry, -exit) %>% 
  group_by(station, month, hour) %>% 
  summarise(avg = mean(avg)) %>% 
  ungroup() %>% 
  ggplot(aes(x = hour, y = avg)) + 
  geom_bar(stat = "identity", 
           position = "stack", 
           fill = "tan") + 
  ylim(0, 150000) + 
  facet_wrap(~ station)
```

Let's try and see the trends for entry and exit per station. Let's try 2012 first

```{r}
# Function to take the year and plot the station trends for that year
take_year <- function(year_){
  select(mrt.dt, -net) %>% 
  filter(year == year_ & hour > 5 & hour < 22) %>% 
  mutate(month = if_else(month < 10, str_c("0", month), as.character(month)), 
         day = if_else(day < 10, str_c("0", day), as.character(day)), 
         hour = if_else(hour < 10, str_c("0", hour), as.character(hour)), 
         time = str_c(as.character(year), month, day, hour) %>% ymd_h) %>% 
  select(-year, -month, -day, -hour) %>% 
  gather(key = "mode", value = "traff", entry, exit) %>% 
  ggplot(aes(time)) + 
  geom_line(aes(y = traff, color = mode)) + 
  facet_wrap(~station)
}
```


```{r}
take_year(2012)
```

Mostly even. 

```{r}
take_year(2013)
```

```{r}
take_year(2014)
```




***
More dataset information: [[Dataset description]](link to website)  

Feedback:  
Email: francis.endrinal@gmail.com  
FB Messenger: m.me/transparencyman  
Twitter, Instagram: @jgendrinal
